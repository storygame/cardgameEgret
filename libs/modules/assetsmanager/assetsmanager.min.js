var __reflect=this&&this.__reflect||function(e,r,t){e.__class__=r,t?t.push(r):t=[r],e.__types__=e.__types__?t.concat(e.__types__):t};var __extends=this&&this.__extends||function e(r,t){function o(){this.constructor=r}for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);o.prototype=t.prototype,r.prototype=new o};var __decorate=this&&this.__decorate||function(e,r,t,o){var n=arguments.length,i=n<3?r:o===null?o=Object.getOwnPropertyDescriptor(r,t):o,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)if(a=e[s])i=(n<3?a(i):n>3?a(r,t,i):a(r,t))||i;return n>3&&i&&Object.defineProperty(r,t,i),i};var RES;(function(e){})(RES||(RES={}));var RES;(function(c){c.resourceNameSelector=function(e){return e};function o(e){var r=c.config.config.fileSystem.getFile(e);if(!r){e=c.resourceNameSelector(e);r=c.config.config.fileSystem.getFile(e)}return r}c.getResourceInfo=o;var n;function e(e,r){var t;if(e.indexOf(".json")>=0){t="legacyResourceConfig"}else{t="resourceConfig"}n={type:t,root:r,url:e,name:e}}c.setConfigURL=e;var r=function(){function e(){}e.prototype.init=function(){if(!this.config){this.config={alias:{},groups:{},resourceRoot:n.root,mergeSelector:null,fileSystem:null,loadGroup:[]}}return c.queue.pushResItem(n).catch(function(e){if(!c.isCompatible){if(!e.__resource_manager_error__){if(e.error){console.error(e.error.stack)}else{console.error(e.stack)}e=new c.ResourceManagerError(1002)}}c.host.remove(n);return Promise.reject(e)})};e.prototype.getGroupByName=function(e){var r=this.config.groups[e];var t=[];if(!r){return t}for(var o=0,n=r;o<n.length;o++){var i=n[o];var a=void 0;a=c.config.getResourceWithSubkey(i);if(a==null){continue}var s=a.r,u=a.key;if(s==null){throw new c.ResourceManagerError(2005,u);continue}if(t.indexOf(s)==-1){t.push(s)}}return t};e.prototype.__temp__get__type__via__url=function(e){var r=this.config.alias[e];if(!r){r=e}if(c.typeSelector){var t=c.typeSelector(r);if(!t){throw new c.ResourceManagerError(2004,r)}return t}else{console.warn("RES.mapConfig 并未设置 typeSelector");return"unknown"}};e.prototype.getResourceWithSubkey=function(e){e=this.getKeyByAlias(e);var r=e.indexOf("#");var t="";if(r>=0){t=e.substr(r+1);e=e.substr(0,r)}var o=this.getResource(e);if(!o){return null}else{return{r:o,key:e,subkey:t}}};e.prototype.getKeyByAlias=function(e){if(this.config.alias[e]){return this.config.alias[e]}else{return e}};e.prototype.getResource=function(e){var r=this.config.alias[e];if(!r){r=e}var t=o(r);if(!t){return null}else{return t}};e.prototype.createGroup=function(e,r,t){if(t===void 0){t=false}if(!t&&this.config.groups[e]||!r||r.length==0){return false}var o=[];for(var n=0,i=r;n<i.length;n++){var a=i[n];if(this.config.groups[a]){var s=this.config.groups[a];o=o.concat(s)}else{o.push(a)}}this.config.groups[e]=o;return true};e.prototype.addSubkey=function(e,r){this.addAlias(e,r+"#"+e)};e.prototype.addAlias=function(e,r){if(this.config.alias[r]){r=this.config.alias[r]}this.config.alias[e]=r};e.prototype.addResourceData=function(e){if(c.hasRes(e.name)){return}if(!e.type){e.type=this.__temp__get__type__via__url(e.url)}c.config.config.fileSystem.addFile(e)};e.prototype.removeResourceData=function(e){if(!c.hasRes(e.name)){return}c.config.config.fileSystem.removeFile(e.url);if(this.config.alias[e.name]){delete this.config.alias[e.name]}};return e}();c.ResourceConfig=r;__reflect(r.prototype,"RES.ResourceConfig")})(RES||(RES={}));var RES;(function(c){var e=function(){function e(){this.groupTotalDic={};this.numLoadedDic={};this.groupErrorDic={};this.retryTimesDic={};this.maxRetryTimes=3;this.reporterDic={};this.dispatcherDic={};this.failedList=new Array;this.loadItemErrorDic={};this.errorDic={};this.itemListPriorityDic={};this.itemLoadDic={};this.promiseHash={};this.lazyLoadList=new Array;this.loadingCount=0;this.thread=4}e.prototype.pushResItem=function(e){if(this.promiseHash[e.root+e.name]){return this.promiseHash[e.root+e.name]}this.lazyLoadList.push(e);this.itemListPriorityDic[Number.NEGATIVE_INFINITY]=this.lazyLoadList;this.updatelistPriority(this.lazyLoadList,Number.NEGATIVE_INFINITY);var o=new egret.EventDispatcher;this.dispatcherDic[e.root+e.name]=o;var r=new Promise(function(r,t){o.addEventListener("complete",function(e){r(e.data)},null);o.addEventListener("error",function(e){t(e.data)},null)});this.promiseHash[e.root+e.name]=r;this.loadNextResource();return r};e.prototype.pushResGroup=function(e,r,t,o){if(this.promiseHash[r]){return this.promiseHash[r]}var n=e.length;for(var i=0;i<n;i++){var a=e[i];if(!a.groupNames){a.groupNames=[]}a.groupNames.push(r)}this.groupTotalDic[r]=e.length;this.numLoadedDic[r]=0;this.updatelistPriority(e,t);this.reporterDic[r]=o;var s=new egret.EventDispatcher;this.dispatcherDic[r]=s;var u=new Promise(function(e,r){s.addEventListener("complete",e,null);s.addEventListener("error",function(e){r(e.data)},null)});this.promiseHash[r]=u;this.loadNextResource();return u};e.prototype.updatelistPriority=function(e,r){if(this.itemListPriorityDic[r]==undefined){this.itemListPriorityDic[r]=[]}for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.itemLoadDic[n.root+n.name]==1){continue}var i=this.findPriorityInDic(n);if(i==undefined){this.itemListPriorityDic[r].push(n)}else{if(i<r){this.itemListPriorityDic[r].push(n);var a=this.itemListPriorityDic[i].indexOf(n);this.itemListPriorityDic[i].splice(a,1)}}}};e.prototype.findPriorityInDic=function(e){for(var r in this.itemListPriorityDic){if(this.itemListPriorityDic[r].indexOf(e)>-1)return parseInt(r)}return undefined};e.prototype.loadNextResource=function(){while(this.loadingCount<this.thread){var e=this.loadSingleResource();if(!e){break}}};e.prototype.loadSingleResource=function(){var s=this;var u=this.getOneResourceInfoInGroup();if(!u)return false;this.itemLoadDic[u.root+u.name]=1;this.loadingCount++;this.loadResource(u).then(function(e){s.loadingCount--;delete s.itemLoadDic[u.root+u.name];c.host.save(u,e);if(s.promiseHash[u.root+u.name]){var r=s.deleteDispatcher(u.root+u.name);r.dispatchEventWith("complete",false,e)}var t=u.groupNames;if(t){delete u.groupNames;for(var o=0,n=t;o<n.length;o++){var i=n[o];if(s.setGroupProgress(i,u)){s.loadGroupEnd(i)}}}s.loadNextResource()}).catch(function(e){if(!e){throw u.name+" load fail"}if(!e.__resource_manager_error__){throw e}delete s.itemLoadDic[u.root+u.name];s.loadingCount--;delete c.host.state[u.root+u.name];var r=s.retryTimesDic[u.name]||1;if(r>s.maxRetryTimes){delete s.retryTimesDic[u.name];if(s.promiseHash[u.root+u.name]){var t=s.deleteDispatcher(u.root+u.name);t.dispatchEventWith("error",false,{r:u,error:e})}var o=u.groupNames;if(o){delete u.groupNames;for(var n=0,i=o;n<i.length;n++){var a=i[n];if(!s.loadItemErrorDic[a]){s.loadItemErrorDic[a]=[]}if(s.loadItemErrorDic[a].indexOf(u)==-1){s.loadItemErrorDic[a].push(u)}s.groupErrorDic[a]=true;if(s.setGroupProgress(a,u)){s.loadGroupEnd(a,e)}else{s.errorDic[a]=e}}}s.loadNextResource()}else{s.retryTimesDic[u.name]=r+1;s.failedList.push(u);s.loadNextResource();return}});return true};e.prototype.getOneResourceInfoInGroup=function(){if(this.failedList.length>0)return this.failedList.shift();var e=Number.NEGATIVE_INFINITY;for(var r in this.itemListPriorityDic){e=Math.max(e,r)}var t=this.itemListPriorityDic[e];if(!t){return undefined}if(t.length==0){delete this.itemListPriorityDic[e];return this.getOneResourceInfoInGroup()}return t.shift()};e.prototype.setGroupProgress=function(e,r){var t=this.reporterDic[e];this.numLoadedDic[e]++;var o=this.numLoadedDic[e];var n=this.groupTotalDic[e];if(t&&t.onProgress){t.onProgress(o,n,r)}return o==n};e.prototype.loadGroupEnd=function(e,r){delete this.groupTotalDic[e];delete this.numLoadedDic[e];delete this.reporterDic[e];var t=this.deleteDispatcher(e);if(!r){var o=this.groupErrorDic[e];delete this.groupErrorDic[e];if(o){var n=this.loadItemErrorDic[e];delete this.loadItemErrorDic[e];var i=this.errorDic[e];delete this.errorDic[e];t.dispatchEventWith("error",false,{itemList:n,error:i})}else{t.dispatchEventWith("complete")}}else{delete this.groupErrorDic[e];var n=this.loadItemErrorDic[e];delete this.loadItemErrorDic[e];t.dispatchEventWith("error",false,{itemList:n,lastError:r})}};e.prototype.deleteDispatcher=function(e){delete this.promiseHash[e];var r=this.dispatcherDic[e];delete this.dispatcherDic[e];return r};e.prototype.loadResource=function(e,r){if(!r){if(c.FEATURE_FLAG.FIX_DUPLICATE_LOAD==1){var t=c.host.state[e.root+e.name];if(t==2){return Promise.resolve(c.host.get(e))}if(t==1){return e.promise}}r=c.processor.isSupport(e)}if(!r){throw new c.ResourceManagerError(2001,e.name,e.type)}c.host.state[e.root+e.name]=1;var o=r.onLoadStart(c.host,e);e.promise=o;return o};e.prototype.unloadResource=function(e){var r=c.host.get(e);if(!r){console.warn("尝试释放不存在的资源:",e.name);return false}var t=c.processor.isSupport(e);if(t){t.onRemoveStart(c.host,e);c.host.remove(e);if(e.extra==1){c.config.removeResourceData(e)}return true}else{return true}};return e}();c.ResourceLoader=e;__reflect(e.prototype,"RES.ResourceLoader")})(RES||(RES={}));var RES;(function(e){e.checkNull=function(e,t,r){var o=r.value;r.value=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}if(!e[0]){console.warn("方法"+t+"的参数不能为null");return null}else{return o.apply(this,e)}}};e.FEATURE_FLAG={FIX_DUPLICATE_LOAD:1};var r;(function(e){var r="warning";function t(e){r=e}e.setUpgradeGuideLevel=t})(r=e.upgrade||(e.upgrade={}))})(RES||(RES={}));var RES;(function(d){function e(e){return d.path.basename(e).split(".").join("_")}d.nameSelector=e;function r(e){var r=e.substr(e.lastIndexOf(".")+1);var t;switch(r){case d.ResourceItem.TYPE_XML:case d.ResourceItem.TYPE_JSON:case d.ResourceItem.TYPE_SHEET:t=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":t=d.ResourceItem.TYPE_IMAGE;break;case"fnt":t=d.ResourceItem.TYPE_FONT;break;case"txt":t=d.ResourceItem.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":t=d.ResourceItem.TYPE_SOUND;break;case"mergeJson":case"zip":case"pvr":t=r;break;default:t=d.ResourceItem.TYPE_BIN;break}return t}d.typeSelector=r;function t(e,r){throw new d.ResourceManagerError(2002)}d.registerAnalyzer=t;function o(e){d.isCompatible=e}d.setIsCompatible=o;d.isCompatible=false;function n(e,r){if(r.indexOf("://")>=0){var t=r.split("://");r=t[0]+"://"+d.path.normalize(t[1]+"/");e=e.replace(r,"")}else{r=d.path.normalize(r+"/");e=e.replace(r,"")}d.setConfigURL(e,r);if(!P)P=new D;return i(P.loadConfig())}d.loadConfig=n;function i(e){if(d.isCompatible){e.catch(function(e){}).then();return undefined}else{return e}}function a(e,r,t){if(r===void 0){r=0}return i(P.loadGroup(e,r,t))}d.loadGroup=a;function s(e){return P.isGroupLoaded(e)}d.isGroupLoaded=s;function u(e){return P.getGroupByName(e).map(function(e){return d.ResourceItem.convertToResItem(e)})}d.getGroupByName=u;function c(e,r,t){if(t===void 0){t=false}return P.createGroup(e,r,t)}d.createGroup=c;function f(e){return P.hasRes(e)}d.hasRes=f;function l(e){return P.getRes(e)}d.getRes=l;function p(e,r,t){return i(P.getResAsync.apply(P,arguments))}d.getResAsync=p;function g(e,r,t,o){if(o===void 0){o=""}return i(P.getResByUrl(e,r,t,o))}d.getResByUrl=g;function v(e,r){return P.destroyRes(e,r)}d.destroyRes=v;function h(e){if(!P)P=new D;P.setMaxLoadingThread(e)}d.setMaxLoadingThread=h;function m(e){P.setMaxRetryTimes(e)}d.setMaxRetryTimes=m;function R(e,r,t,o,n){if(o===void 0){o=false}if(n===void 0){n=0}if(!P)P=new D;P.addEventListener(e,r,t,o,n)}d.addEventListener=R;function E(e,r,t,o){if(o===void 0){o=false}P.removeEventListener(e,r,t,o)}d.removeEventListener=E;function y(e){P.addResourceData(e)}d.$addResourceData=y;function _(){if(!P)P=new D;return P.vcs}d.getVersionController=_;function S(e){if(!P)P=new D;P.registerVersionController(e)}d.registerVersionController=S;function L(e){if(P.vcs){return P.vcs.getVirtualUrl(e)}else{return e}}d.getVirtualUrl=L;var D=function(e){__extends(r,e);function r(){var r=e.call(this)||this;r.isVcsInit=false;r.normalLoadConfig=function(){return d.config.init().then(function(e){d.ResourceEvent.dispatchResourceEvent(r,d.ResourceEvent.CONFIG_COMPLETE)},function(e){d.ResourceEvent.dispatchResourceEvent(r,d.ResourceEvent.CONFIG_LOAD_ERROR);return Promise.reject(e)})};if(d.VersionController){r.vcs=new d.VersionController}return r}r.prototype.registerVersionController=function(e){this.vcs=e;this.isVcsInit=false};r.prototype.loadConfig=function(){var e=this;if(!this.isVcsInit&&this.vcs){this.isVcsInit=true;return this.vcs.init().then(function(){return e.normalLoadConfig()})}else{return this.normalLoadConfig()}};r.prototype.isGroupLoaded=function(e){var r=d.config.getGroupByName(e);return r.every(function(e){return d.host.get(e)!=null})};r.prototype.getGroupByName=function(e){return d.config.getGroupByName(e)};r.prototype.loadGroup=function(i,e,o){var a=this;if(e===void 0){e=0}var r={onProgress:function(e,r,t){if(o&&o.onProgress){o.onProgress(e,r,t)}d.ResourceEvent.dispatchResourceEvent(a,d.ResourceEvent.GROUP_PROGRESS,i,t,e,r)}};return this._loadGroup(i,e,r).then(function(e){if(d.config.config.loadGroup.indexOf(i)==-1){d.config.config.loadGroup.push(i)}d.ResourceEvent.dispatchResourceEvent(a,d.ResourceEvent.GROUP_COMPLETE,i)},function(e){if(d.config.config.loadGroup.indexOf(i)==-1){d.config.config.loadGroup.push(i)}if(e.itemList){var r=e.itemList;var t=r.length;for(var o=0;o<t;o++){var n=r[o];delete n.promise;d.ResourceEvent.dispatchResourceEvent(a,d.ResourceEvent.ITEM_LOAD_ERROR,i,n)}}if(d.isCompatible){console.warn(e.error.message)}d.ResourceEvent.dispatchResourceEvent(a,d.ResourceEvent.GROUP_LOAD_ERROR,i);return Promise.reject(e.error)})};r.prototype._loadGroup=function(t,e,r){if(e===void 0){e=0}var o=d.config.getGroupByName(t);if(o.length==0){return new Promise(function(e,r){r({error:new d.ResourceManagerError(2005,t)})})}return d.queue.pushResGroup(o,t,e,r)};r.prototype.createGroup=function(e,r,t){if(t===void 0){t=false}return d.config.createGroup(e,r,t)};r.prototype.hasRes=function(e){return d.config.getResourceWithSubkey(e)!=null};r.prototype.getRes=function(e){var r=d.config.getResourceWithSubkey(e);if(r){var t=r.r;var o=r.key;var n=r.subkey;var i=d.processor.isSupport(t);if(i&&i.getData&&n){return i.getData(d.host,t,o,n)}else{return d.host.get(t)}}else{return null}};r.prototype.getResAsync=function(t,o,n){var r=this;var i=t;var e=d.config.getResourceWithSubkey(t);if(e==null){if(o){o.call(n,null,i)}return Promise.reject(new d.ResourceManagerError(2006,t))}var a=e.r,s=e.subkey;return d.queue.pushResItem(a).then(function(e){d.host.save(a,e);var r=d.processor.isSupport(a);if(r&&r.getData&&s){e=r.getData(d.host,a,t,s)}if(o){o.call(n,e,i)}return e},function(e){d.host.remove(a);d.ResourceEvent.dispatchResourceEvent(r,d.ResourceEvent.ITEM_LOAD_ERROR,"",a);if(o){o.call(n,null,i);return Promise.reject(null)}return Promise.reject(e)})};r.prototype.getResByUrl=function(r,t,o,e){var n=this;if(e===void 0){e=""}var i=d.config.getResource(r);if(!i){if(!e){e=d.config.__temp__get__type__via__url(r)}i={name:r,url:r,type:e,root:"",extra:1};d.config.addResourceData(i);i=d.config.getResource(r);if(!i){throw"never"}}return d.queue.pushResItem(i).then(function(e){d.host.save(i,e);if(t&&i){t.call(o,e,i.url)}return e},function(e){d.host.remove(i);d.ResourceEvent.dispatchResourceEvent(n,d.ResourceEvent.ITEM_LOAD_ERROR,"",i);if(t){t.call(o,null,r);return Promise.reject(null)}return Promise.reject(e)})};r.prototype.destroyRes=function(e,r){if(r===void 0){r=true}var t=d.config.getGroupByName(e);if(t&&t.length>0){var o=d.config.config.loadGroup.indexOf(e);if(o==-1){return false}if(r||d.config.config.loadGroup.length==1&&d.config.config.loadGroup[0]==e){for(var n=0,i=t;n<i.length;n++){var a=i[n];d.queue.unloadResource(a)}d.config.config.loadGroup.splice(o,1)}else{var s={};for(var u=0,c=d.config.config.loadGroup;u<c.length;u++){var f=c[u];for(var l in d.config.config.groups[f]){var p=d.config.config.groups[f][l];if(s[p]){s[p]++}else{s[p]=1}}}for(var g=0,v=t;g<v.length;g++){var a=v[g];if(s[a.name]&&s[a.name]==1){d.queue.unloadResource(a)}}d.config.config.loadGroup.splice(o,1)}return true}else{var a=d.config.getResource(e);if(a){return d.queue.unloadResource(a)}else{console.warn("在内存"+e+"资源不存在");return false}}};r.prototype.setMaxLoadingThread=function(e){if(e<1){e=1}d.queue.thread=e};r.prototype.setMaxRetryTimes=function(e){e=Math.max(e,0);d.queue.maxRetryTimes=e};r.prototype.addResourceData=function(e){e["root"]="";d.config.addResourceData(e)};__decorate([d.checkNull],r.prototype,"hasRes",null);__decorate([d.checkNull],r.prototype,"getRes",null);__decorate([d.checkNull],r.prototype,"getResAsync",null);__decorate([d.checkNull],r.prototype,"getResByUrl",null);return r}(egret.EventDispatcher);d.Resource=D;__reflect(D.prototype,"RES.Resource");var P})(RES||(RES={}));var RES;(function(e){var r;(function(e){function r(e){var t=e.split("/");return t.filter(function(e,r){return!!e||r==t.length-1}).join("/")}e.normalize=r;function t(e){return e.substr(e.lastIndexOf("/")+1)}e.basename=t;function o(e){return e.substr(0,e.lastIndexOf("/"))}e.dirname=o})(r=e.path||(e.path={}))})(RES||(RES={}));var RES;(function(e){var r=function(){function e(){}e.prototype.init=function(){this.versionInfo=this.getLocalData("all.manifest");return Promise.resolve()};e.prototype.getVirtualUrl=function(e){return e};e.prototype.getLocalData=function(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var r=egret_native.readUpdateFileSync(e);if(r!=null){return JSON.parse(r)}r=egret_native.readResourceFileSync(e);if(r!=null){return JSON.parse(r)}}return null};return e}();e.NativeVersionController=r;__reflect(r.prototype,"RES.NativeVersionController",["RES.IVersionController"]);if(egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE){e.VersionController=r}})(RES||(RES={}));var RES;(function(h){var e;(function(t){function e(e){return t._map[e.type]}t.isSupport=e;function r(e,r){t._map[e]=r}t.map=r;function o(n,i){var a=this;return new Promise(function(r,t){var e=function(){var e=n["data"]?n["data"]:n["response"];r(e)};var o=function(){var e=new h.ResourceManagerError(1001,i.url);t(e)};n.addEventListener(egret.Event.COMPLETE,e,a);n.addEventListener(egret.IOErrorEvent.IO_ERROR,o,a)})}function a(e,r){if(r.indexOf("://")!=-1){return r}e=e.split("\\").join("/");var t=e.match(/#.*|\?.*/);var o="";if(t){o=t[0]}var n=e.lastIndexOf("/");if(n!=-1){e=e.substring(0,n+1)+r}else{e=r}return e+o}t.getRelativePath=a;t.ImageProcessor={onLoadStart:function(n,i){var e=new egret.ImageLoader;e.load(h.getVirtualUrl(i.root+i.url));return o(e,i).then(function(e){var r=new egret.Texture;r._setBitmapData(e);var t=n.resourceConfig.getResource(i.name);if(t&&t.scale9grid){var o=t.scale9grid.split(",");r["scale9Grid"]=new egret.Rectangle(parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3]))}return r})},onRemoveStart:function(e,r){var t=e.get(r);t.dispose()}};t.BinaryProcessor={onLoadStart:function(e,r){var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.ARRAY_BUFFER;t.open(h.getVirtualUrl(r.root+r.url),"get");t.send();return o(t,r)},onRemoveStart:function(e,r){}};t.TextProcessor={onLoadStart:function(e,r){var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT;t.open(h.getVirtualUrl(r.root+r.url),"get");t.send();return o(t,r)},onRemoveStart:function(e,r){return true}};t.JsonProcessor={onLoadStart:function(e,r){return e.load(r,"text").then(function(e){var r=JSON.parse(e);return r})},onRemoveStart:function(e,r){}};t.XMLProcessor={onLoadStart:function(e,r){return e.load(r,"text").then(function(e){var r=egret.XML.parse(e);return r})},onRemoveStart:function(e,r){return true}};t.CommonJSProcessor={onLoadStart:function(e,n){return e.load(n,"text").then(function(e){var r=new Function("require","exports",e);var t=function(){};var o={};try{r(t,o)}catch(e){throw new h.ResourceManagerError(2003,n.name,e.message)}return o})},onRemoveStart:function(e,r){}};t.SheetProcessor={onLoadStart:function(f,r){return f.load(r,"json").then(function(u){var c=f.resourceConfig.getResource(h.nameSelector(u.file));if(!c){var e=a(r.url,u.file);console.log("imageName: ",e);c={name:e,url:e,type:"image",root:""}}return f.load(c).then(function(e){var r=u.frames;var t=new egret.SpriteSheet(e);t["$resourceInfo"]=c;for(var o in r){var n=r[o];var i=t.createTexture(o,n.x,n.y,n.w,n.h,n.offX,n.offY,n.sourceW,n.sourceH);if(n["scale9grid"]){var a=n["scale9grid"];var s=a.split(",");i["scale9Grid"]=new egret.Rectangle(parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3]))}}f.save(c,e);return t},function(e){f.remove(c);throw e})})},getData:function(e,r,t,o){var n=e.get(r);if(n){return n.getTexture(o)}else{return null}},onRemoveStart:function(e,r){var t=e.get(r);var o=t["$resourceInfo"];t.dispose();e.unload(o)}};var s=function(e,r){var t="";var o=r.split("\n");var n=o[2];var i=n.indexOf('file="');if(i!=-1){n=n.substring(i+6);i=n.indexOf('"');t=n.substring(0,i)}e=e.split("\\").join("/");var i=e.lastIndexOf("/");if(i!=-1){e=e.substring(0,i+1)+t}else{e=t}return e};t.FontProcessor={onLoadStart:function(n,i){return n.load(i,"text").then(function(r){var t;try{t=JSON.parse(r)}catch(e){t=r}var e;if(typeof t==="string"){e=s(i.url,t)}else{e=a(i.url,t.file)}var o=n.resourceConfig.getResource(h.nameSelector(e));if(!o){o={name:e,url:e,type:"image",root:i.root}}return n.load(o).then(function(e){var r=new egret.BitmapFont(e,t);r["$resourceInfo"]=o;n.save(o,e);return r},function(e){n.remove(o);throw e})})},onRemoveStart:function(e,r){var t=e.get(r);var o=t["$resourceInfo"];e.unload(o)}};t.SoundProcessor={onLoadStart:function(e,r){var t=new egret.Sound;t.load(h.getVirtualUrl(r.root+r.url));return o(t,r).then(function(){return t})},onRemoveStart:function(e,r){}};t.MovieClipProcessor={onLoadStart:function(o,n){var i;var a;return o.load(n,"json").then(function(e){i=e;var r=n.name;var t=r.substring(0,r.lastIndexOf("."))+".png";a=o.resourceConfig.getResource(t);if(!a){throw new h.ResourceManagerError(1001,t)}return o.load(a)}).then(function(e){o.save(a,e);var r=e;var t=new egret.MovieClipDataFactory(i,r);return t})},onRemoveStart:function(e,r){var t=e.get(r);t.clearCache();t.$spriteSheet.dispose();var o=r.name;var n=o.substring(0,o.lastIndexOf("."))+".png";var i=e.resourceConfig.getResource(n);if(i){e.unload(i)}}};t.MergeJSONProcessor={onLoadStart:function(e,t){return e.load(t,"json").then(function(e){for(var r in e){h.config.addSubkey(r,t.name)}return e})},getData:function(e,r,t,o){var n=e.get(r);if(n){return n[o]}else{console.error("missing resource :"+r.name);return null}},onRemoveStart:function(e,r){}};t.LegacyResourceConfigProcessor={onLoadStart:function(v,d){return v.load(d,"json").then(function(e){var r=h.config.config;var t=d.root;var o=r.fileSystem;if(!o){o={fsData:{},getFile:function(e){return c[e]},addFile:function(e){if(!e.type)e.type="";if(t==undefined){e.root=""}c[e.name]=e},profile:function(){console.log(c)},removeFile:function(e){delete c[e]}};r.fileSystem=o}var n=r.groups;for(var i=0,a=e.groups;i<a.length;i++){var s=a[i];if(s.keys==""){n[s.name]=[]}else{n[s.name]=s.keys.split(",")}}var u=r.alias;var c=o["fsData"];var f=function(r){c[r.name]=r;c[r.name].root=t;if(r.subkeys){r.subkeys.split(",").forEach(function(e){u[e]=r.name+"#"+e;u[r.name+"."+e]=r.name+"#"+e})}};for(var l=0,p=e.resources;l<p.length;l++){var g=p[l];f(g)}v.save(d,e);return e})},onRemoveStart:function(){}};t._map={image:t.ImageProcessor,json:t.JsonProcessor,text:t.TextProcessor,xml:t.XMLProcessor,sheet:t.SheetProcessor,font:t.FontProcessor,bin:t.BinaryProcessor,commonjs:t.CommonJSProcessor,sound:t.SoundProcessor,movieclip:t.MovieClipProcessor,mergeJson:t.MergeJSONProcessor,legacyResourceConfig:t.LegacyResourceConfigProcessor}})(e=h.processor||(h.processor={}))})(RES||(RES={}));var RES;(function(c){var e=function(n){__extends(u,n);function u(e,r,t){if(r===void 0){r=false}if(t===void 0){t=false}var o=n.call(this,e,r,t)||this;o.itemsLoaded=0;o.itemsTotal=0;o.groupName="";return o}u.dispatchResourceEvent=function(e,r,t,o,n,i){if(t===void 0){t=""}if(o===void 0){o=undefined}if(n===void 0){n=0}if(i===void 0){i=0}var a=egret.Event.create(u,r);a.groupName=t;if(o){a.resItem=c.ResourceItem.convertToResItem(o)}a.itemsLoaded=n;a.itemsTotal=i;var s=e.dispatchEvent(a);egret.Event.release(a);return s};u.ITEM_LOAD_ERROR="itemLoadError";u.CONFIG_COMPLETE="configComplete";u.CONFIG_LOAD_ERROR="configLoadError";u.GROUP_PROGRESS="groupProgress";u.GROUP_COMPLETE="groupComplete";u.GROUP_LOAD_ERROR="groupLoadError";return u}(egret.Event);c.ResourceEvent=e;__reflect(e.prototype,"RES.ResourceEvent")})(RES||(RES={}));var RES;(function(n){var e;(function(e){e.TYPE_XML="xml";e.TYPE_IMAGE="image";e.TYPE_BIN="bin";e.TYPE_TEXT="text";e.TYPE_JSON="json";e.TYPE_SHEET="sheet";e.TYPE_FONT="font";e.TYPE_SOUND="sound";function r(e){var r=e.name;if(!n.config.config){r=e.url}else{for(var t in n.config.config.alias){if(n.config.config.alias[t]==e.url){r=t}}}var o={name:r,url:e.url,type:e.type,data:e,root:e.root};return o}e.convertToResItem=r})(e=n.ResourceItem||(n.ResourceItem={}))})(RES||(RES={}));var RES;(function(a){var e=function(){function e(e){this.data=e}e.prototype.profile=function(){console.log(this.data)};e.prototype.addFile=function(e,r){if(!r)r="";e=a.path.normalize(e);var t=a.path.basename(e);var o=a.path.dirname(e);if(!this.exists(o)){this.mkdir(o)}var n=this.resolve(o);n[t]={url:e,type:r}};e.prototype.getFile=function(e){var r=this.resolve(e);if(r){r.name=e}return r};e.prototype.resolve=function(e){if(e==""){return this.data}e=a.path.normalize(e);var r=e.split("/");var t=this.data;for(var o=0,n=r;o<n.length;o++){var i=n[o];if(t){t=t[i]}else{return t}}return t};e.prototype.mkdir=function(e){e=a.path.normalize(e);var r=e.split("/");var t=this.data;for(var o=0,n=r;o<n.length;o++){var i=n[o];if(!t[i]){t[i]={}}t=t[i]}};e.prototype.exists=function(e){if(e=="")return true;e=a.path.normalize(e);var r=e.split("/");var t=this.data;for(var o=0,n=r;o<n.length;o++){var i=n[o];if(!t[i]){return false}t=t[i]}return true};return e}();a.NewFileSystem=e;__reflect(e.prototype,"RES.NewFileSystem")})(RES||(RES={}));var RES;(function(o){var n={};function e(){o.config.config.fileSystem.profile();console.log(n);var e=0;for(var r in n){var t=n[r];if(t instanceof egret.Texture){e+=t.$bitmapWidth*t.$bitmapHeight*4}}console.log("gpu size : "+(e/1024).toFixed(3)+"kb")}o.profile=e;o.host={state:{},get resourceConfig(){return o.config},load:function(e,r){var t=typeof r=="string"?o.processor._map[r]:r;return o.queue["loadResource"](e,t)},unload:function(e){return o.queue.unloadResource(e)},save:function(e,r){o.host.state[e.root+e.name]=2;delete e.promise;n[e.root+e.name]=r},get:function(e){return n[e.root+e.name]},remove:function(e){delete o.host.state[e.root+e.name];delete n[e.root+e.name]}};o.config=new o.ResourceConfig;o.queue=new o.ResourceLoader;var r=function(n){__extends(i,n);function i(e,r,t){var o=n.call(this)||this;o.__resource_manager_error__=true;o.name=e.toString();o.message=i.errorMessage[e].replace("{0}",r).replace("{1}",t);return o}i.errorMessage={1001:"文件加载失败:{0}",1002:"ResourceManager 初始化失败：配置文件加载失败",2001:"{0}解析失败,不支持指定解析类型:'{1}'，请编写自定义 Processor ，更多内容请参见 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2002:"Analyzer 相关API 在 ResourceManager 中不再支持，请编写自定义 Processor ，更多内容请参见 https://github.com/egret-labs/resourcemanager/blob/master/docs/README.md#processor",2003:"{0}解析失败,错误原因:{1}",2004:"无法找到文件类型:{0}",2005:'RES加载了不存在或空的资源组:"{0}"',2006:"资源配置文件中无法找到特定的资源:{0}"};return i}(Error);o.ResourceManagerError=r;__reflect(r.prototype,"RES.ResourceManagerError")})(RES||(RES={}));